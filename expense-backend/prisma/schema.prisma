generator client {
  provider = "prisma-client"
  // gera o client em src/generated/prisma
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  expenses         Expense[]
  categories       Category[]
  paidInstallments Installment[]
}

model Category {
  id     Int    @id @default(autoincrement())
  name   String
  userId Int
  user   User   @relation(fields: [userId], references: [id])

  expenses Expense[]
}

model Expense {
  id               Int           @id @default(autoincrement())
  date             DateTime
  description      String
  location         String?
  totalAmount      Decimal       @db.Decimal(10, 2)
  isInstallment    Boolean       @default(false)
  installmentCount Int           @default(1)
  isShared         Boolean       @default(false)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id])

  installments Installment[]
}

model Installment {
  id        Int      @id @default(autoincrement())
  number    Int
  amount    Decimal  @db.Decimal(10, 2)
  date      DateTime // competence date
  status    String   @default("OPEN") // OPEN, PAID
  paidAt    DateTime?
  
  expenseId Int
  expense   Expense @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  
  paidById  Int?
  paidBy    User?   @relation(fields: [paidById], references: [id])
}
